@page "/checklist"
@using BlazorControls.Components
@using BlazorControls.Data.Models
@rendermode InteractiveServer

<h2>Reusable CheckBoxList Demo</h2>
<br />

<!-- Scenario 1: Employees -->
<h3>1. Employees (Object List)</h3>

<CheckBoxList Items="@EmployeeList"
              KeySelector="e => e.EmployeeId.ToString()"
              LabelSelector="e => e.FullName"
              CheckedSelector="e => SelectedEmployeeMap[e.EmployeeId.ToString()]"
              OnChanged="OnEmployeeChanged"
              SelectAll="SelectAllEmployees"
              ClearAll="ClearAllEmployees" />


<div class="output-row">
    <label>Selected Employee Values:</label>
    @string.Join(", ", SelectedEmployeeMap.Where(kvp => kvp.Value).Select(kvp => kvp.Key))
</div>

<div class="output-row">
    <label>Selected Employee Texts:</label>
    @string.Join(", ", EmployeeList
        .Where(e => SelectedEmployeeMap[e.EmployeeId.ToString()])
        .Select(e => e.FullName))
</div>

<div class="output-row">
    <label>Selected Employee Map:</label>
    @string.Join(", ", SelectedEmployeeMap.OrderBy(kvp => kvp.Key)
        .Select(kvp => $"{kvp.Key}:{kvp.Value}"))
</div>

<br />

<!-- Scenario 2: Colors -->
<h3>2. Colors (Strings)</h3>

<CheckBoxList Items="@ColorList"
              KeySelector="c => c"
              LabelSelector="c => c"
              CheckedSelector="c => SelectedColorMap[c]"
              OnChanged="OnColorChanged" />

<div class="output-row">
    <label>Selected Color Values:</label>
    @string.Join(", ", SelectedColorMap.Where(kvp => kvp.Value).Select(kvp => kvp.Key))
</div>

<div class="output-row">
    <label>Selected Color Texts:</label>
    @string.Join(", ", SelectedColorMap.Where(kvp => kvp.Value).Select(kvp => kvp.Key))
</div>

<div class="output-row">
    <label>Selected Color Map:</label>
    @string.Join(", ", SelectedColorMap.OrderBy(kvp => kvp.Key)
        .Select(kvp => $"{kvp.Key}:{kvp.Value}"))
</div>

<br />

<!-- Scenario 3: Departments -->
<h3>3. Departments (Strings)</h3>

<CheckBoxList Items="@DepartmentList"
              KeySelector="d => d"
              LabelSelector="d => d"
              CheckedSelector="d => SelectedDepartmentMap[d]"
              OnChanged="OnDepartmentChanged" />

<div class="output-row">
    <label>Selected Department Values:</label>
    @string.Join(", ", SelectedDepartmentMap.Where(kvp => kvp.Value).Select(kvp => kvp.Key))
</div>

<div class="output-row">
    <label>Selected Department Texts:</label>
    @string.Join(", ", SelectedDepartmentMap.Where(kvp => kvp.Value).Select(kvp => kvp.Key))
</div>

<div class="output-row">
    <label>Selected Department Map:</label>
    @string.Join(", ", SelectedDepartmentMap.OrderBy(kvp => kvp.Key)
        .Select(kvp => $"{kvp.Key}:{kvp.Value}"))
</div>

<br />

<!-- Scenario 4: Status Dictionary -->
<h3>4. Statuses (Dictionary)</h3>

<CheckBoxList Items="@StatusList"
              KeySelector="kvp => kvp.Key"
              LabelSelector="kvp => kvp.Key"
              CheckedSelector="kvp => SelectedStatusMap[kvp.Key]"
              OnChanged="OnStatusChanged" />

<div class="output-row">
    <label>Selected Status Map:</label>
    @string.Join(", ", SelectedStatusMap.OrderBy(kvp => kvp.Key)
        .Select(kvp => $"{kvp.Key}:{kvp.Value}"))
</div>

@code {
    // Employees
    private List<Employee> EmployeeList = new()
    {
        new Employee { EmployeeId = 1, FirstName = "Alice", LastName = "Smith" },
        new Employee { EmployeeId = 2, FirstName = "Bob", LastName = "Johnson" },
        new Employee { EmployeeId = 3, FirstName = "Charlie", LastName = "Brown" }
    };

    private Dictionary<string, bool> SelectedEmployeeMap = new();

    private Task OnEmployeeChanged((string Key, bool IsChecked) change)
    {
        SelectedEmployeeMap[change.Key] = change.IsChecked;
        return Task.CompletedTask;
    }

    // Colors
    private List<string> ColorList = new() { "Red", "Green", "Blue", "Yellow" };
    private Dictionary<string, bool> SelectedColorMap = new();

    private Task OnColorChanged((string Key, bool IsChecked) change)
    {
        SelectedColorMap[change.Key] = change.IsChecked;
        return Task.CompletedTask;
    }

    // Departments
    private List<string> DepartmentList = new() { "HR", "Finance", "IT", "Sales" };
    private Dictionary<string, bool> SelectedDepartmentMap = new();

    private Task OnDepartmentChanged((string Key, bool IsChecked) change)
    {
        SelectedDepartmentMap[change.Key] = change.IsChecked;
        return Task.CompletedTask;
    }

    // Statuses
    private Dictionary<string, int> StatusList = new()
    {
        { "Open", 12 },
        { "In Progress", 7 },
        { "Closed", 30 },
        { "On Hold", 3 }
    };

    private Dictionary<string, bool> SelectedStatusMap = new();

    private Task OnStatusChanged((string Key, bool IsChecked) change)
    {
        SelectedStatusMap[change.Key] = change.IsChecked;
        return Task.CompletedTask;
    }

    protected override void OnInitialized()
    {
        // Initialize all maps to false
        SelectedEmployeeMap = EmployeeList.ToDictionary(e => e.EmployeeId.ToString(), _ => false);
        SelectedColorMap = ColorList.ToDictionary(c => c, _ => false);
        SelectedDepartmentMap = DepartmentList.ToDictionary(d => d, _ => false);
        SelectedStatusMap = StatusList.Keys.ToDictionary(k => k, _ => false);
    }
    private Task SelectAllEmployees()
    {
        foreach (var key in SelectedEmployeeMap.Keys.ToList())
            SelectedEmployeeMap[key] = true;

        return Task.CompletedTask;
    }

    private Task ClearAllEmployees()
    {
        foreach (var key in SelectedEmployeeMap.Keys.ToList())
            SelectedEmployeeMap[key] = false;

        return Task.CompletedTask;
    }

}
